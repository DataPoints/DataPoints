<script>
    $(function () {
        $('#test_chart').highcharts({
            title: {
                text: 'Users graph',
                x: -20 //center
            },

            xAxis: {

                categories: <%=raw @xData %>
            },

            yAxis: {
                title: {
                    text: 'Selected Column'
                },

                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },

            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },

            series: [{
                name: 'Y axis',
                data: <%=raw @yData %>
            }]
        });
    });
</script>
<script>
    google.maps.event.addDomListener(window, 'load', initMap);

    $(document).ready(initMap());

    function initMap() {
        var handler = Gmaps.build('Google');
        handler.buildMap({internal: {id: 'map'}}, function () {
            var markers = handler.addMarkers([
                <% @coordinates.each do |coordinate| %>
                <%= "{ lat: #{coordinate.lat}, lng: #{coordinate.lng}, infowindow: \"#{coordinate.mesto}\" },".html_safe %>
                <% end %>
            ]);
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();
        });
    }

    function ShowMap() {
        document.getElementById('MapWrapper').style.display = "block";
        initMap()
    }

    function HideMap() {
        document.getElementById('MapWrapper').style.display = "none";
    }
</script>

<%= link_to 'Back', datasets_path, style: 'left: 35px', class: 'btn btn-default' %><br>

<div id="MapWrapper" style='width: 800px; margin: auto; border: solid; box-shadow: 4px; padding: 1px; display: block;'>
  <div id="map" style='width: 793px; height: 400px;'></div>
</div>

<button type="button" class="btn btn-primary btn-lg" onclick="ShowMap()">Show map</button>

<button type="button" class="btn btn-primary btn-lg" onclick="HideMap()">Hide map</button>

<hr>

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
  Start Analyze
</button>
<br>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Analyze Information</h4>
      </div>
      <div class="modal-body">
        Analyze can take a lot of time. Go for a cup of coffee and chillax. We will send you a email to let you know, that your dataset is over.   
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>  
        <%= form_tag({controller: 'datasets', action: 'start_analyze'}, method: 'get', class: 'jahoda', data: {status: @dataset.status} ) do %>
          <%= hidden_field_tag :id , @dataset.id %>
          <%= submit_tag 'Start Analyze', class: 'btn btn-primary' %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!--<%= @dataset.status %>-->
<% if @dataset.status == "S" %>
    Neanalyzovany
<% end %>
<% if @dataset.status == "WA" %>
    Analyza prave prebieha
<% end %>
<% if @dataset.status == "EA" %>
    Analyza uspesne ukoncena
    <%= @dataset.analysis_results[0].result %>
<% end %>

<table class="table table-striped table-bordered">
    <tr>
        <th>index</th>
        <th>analysis progress</th>
        <th>analysis result</th>
    </tr>
    <% @dataset.analysis_results.each_with_index do |result, index| %>
        <tr>
            <td><%= index + 1 %></td>
            <td><%= result.analysisProgress  %></td>
            <td>
              <% if result.analysisProgress == 100 %>
                <%= result.result %>
              <% else %>
                  Analysis still in progress
              <% end %>
            </td>
        </tr>
     <% end %>
</table>


<table class="table table-striped" style="width: 400px; margin-left: 50px;">
  <tr>
    <td><b>Dataset name: </b></td>
    <td><%= @dataset.name %></td>
  </tr>
  <tr>
    <td><b>Dataset description: </b></td>
    <td><%= @dataset.description %></td>
  </tr>
  <tr>
    <td><b>Dataset created_at: </b></td>
    <td><%= @dataset.created_at.strftime('%d %b %H:%M') %></td>
  </tr>
  <tr>
    <td><b>Dataset updated_at: </b></td>
    <td><%= @dataset.updated_at.strftime('%d %b %H:%M') %></td>
  </tr>
  <tr>
    <td><b>Dataset analyzed_progress: </b></td>
    <td> <%= @dataset.analyzed_progress %></td>
  </tr>
  <tr>
    <td><b>Dataset pocet riadkov: </b></td>
    <td> <%= @data.count %></td>
  </tr>
</table>

<br><br><br>

<table class="table table-striped table-bordered" style="margin-left: 50px;">
  <tr>
    <% for i in 0..@names_of_data_columns.count %>
        <th><%= @names_of_data_columns[i] %></th>
    <% end %>
  </tr>
  <% for i in 1..@number_of_data_rows do %>
      <% data_row = @data.find(i) %>
      <tr>
        <% for j in 0..@names_of_data_columns.count %>
            <td><%= data_row[@names_of_data_columns[j]] %></td>
        <% end %>
      </tr>
  <% end %>
</table>


<%= form_tag({controller: 'datasets', action: 'change_type'}, method: 'get') do %>
    <%= label_tag(:column_id, 'Meno stlpca') %>
    <%= select_tag(:column_id, options_for_select(@columns.collect { |column| [column.label, column.id] })) %>
    <%= label_tag(:type_id, 'Typ v stlpci') %>
    <%= select_tag(:type_id, options_for_select([['Mesto', 1]])) %>
    <%= hidden_field_tag :id, @dataset.id %>
    <%= submit_tag 'Update', class: 'btn btn-primary' %>
<% end %>

<%= form_tag({controller: 'datasets', action: 'change_X_Y'}, method: 'get') do %>
    X
    <%= select_tag(:column_x, options_for_select(@columns.collect { |column| [column.label, column.id] })) %>
    Y
    <%= select_tag(:column_y, options_for_select(@columns.collect { |column| [column.label, column.id] })) %>
    <%= hidden_field_tag :id, @dataset.id %>

    <%= submit_tag 'Choose', class: 'btn btn-primary' %>
<% end %>

<div id='test_chart' style=" width: 100%; height: 300px;margin: auto ;"></div>
