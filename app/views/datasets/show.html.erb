<script>
    $(function () {
        $('#test_chart').highcharts({
            title: {
                text: 'Users graph',
                x: -20 //center
            },

            xAxis: {

                categories: <%=raw @xData %>
            },

            yAxis: {
                title: {
                    text: 'Selected Column'
                },

                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },

            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },

            series: [{
                name: 'Y axis',
                data: <%=raw @yData %>
            }]
        });
    });
</script>
<script>
    google.maps.event.addDomListener(window, 'load', initMap);

    $(document).ready(initMap());

    function initMap() {
        var handler = Gmaps.build('Google');
        handler.buildMap({internal: {id: 'map'}}, function () {
            var markers = handler.addMarkers([
                <% @coordinates.each do |coordinate| %>
                <%= "{ lat: #{coordinate.lat}, lng: #{coordinate.lng}, infowindow: \"#{coordinate.mesto}\" },".html_safe %>
                <% end %>
            ]);
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();
        });
    }

    function ShowMap() {
        document.getElementById('MapWrapper').style.display = "block";
        initMap()
    }

    function HideMap() {
        document.getElementById('MapWrapper').style.display = "none";
    }
</script>

<%= link_to 'Back', datasets_path, style: 'left: 35px', class: 'btn btn-default left' %><br>

<div class="row">
    <div class="col-md-6">
        <table class="table table-striped" style="max-width: 400px;">
          <tr>
            <td><b>Dataset name: </b></td>
            <td><%= @dataset.name %></td>
          </tr>
          <tr>
            <td><b>Dataset description: </b></td>
            <td><%= @dataset.description %></td>
          </tr>
          <tr>
            <td><b>Dataset created_at: </b></td>
            <td><%= @dataset.created_at.strftime('%d %b %H:%M') %></td>
          </tr>
          <tr>
            <td><b>Dataset updated_at: </b></td>
            <td><%= @dataset.updated_at.strftime('%d %b %H:%M') %></td>
          </tr>
          <tr>
            <td><b>Dataset analyzed_progress: </b></td>
            <td> <%= @dataset.analyzed_progress %></td>
          </tr>
          <tr>
            <td><b>Dataset pocet riadkov: </b></td>
            <td> <%= @data.count %></td>
          </tr>
        </table>
    </div>

    <div class="col-md-6">
      <div id="MapWrapper" style='max-width: 800px; margin: auto; border: solid; box-shadow: 4px; padding: 1px; display: block;'>
        <div id="map" style='max-width: 793px; height: 400px;'></div>
      </div>

      <button type="button" class="btn btn-default" onclick="ShowMap()">Show map</button>

      <button type="button" class="btn btn-default" onclick="HideMap()">Hide map</button>
    </div>
</div>

<hr>

<table class="table table-striped table-bordered">
  <tr>
    <td></td>
    <% @columns.each do |column| %>
        <td>
          <%= form_tag({controller: 'datasets', action: 'change_type'}, method: 'get') do %>
              <%= hidden_field_tag :id, @dataset.id %>
              <%= hidden_field_tag :column_id, column.id %>
              <%= select_tag(:type_id, options_for_select(@types.collect { |type| [type.name, type.id] }, column.type_id ), :onchange => ("$(this).parent('form').submit();")) %>
          <% end %>
        </td>
    <% end %>
  </tr>
  <tr>
    <% for i in 0..@names_of_data_columns.count-1 %>
        <th><%= @names_of_data_columns[i] %></th>
    <% end %>
  </tr>
  <% for i in 1..@number_of_data_rows do %>
      <% data_row = @data.find(i) %>
      <tr>
        <% for j in 0..@names_of_data_columns.count-1 %>
            <td><%= data_row[@names_of_data_columns[j]] %></td>
        <% end %>
      </tr>
  <% end %>
</table>

<hr />
<%= form_tag({controller: 'datasets', action: 'change_X_Y'}, method: 'get') do %>
    X
    <%= select_tag(:column_x, options_for_select(@columns.collect { |column| [column.label, column.id] })) %>
    Y
    <%= select_tag(:column_y, options_for_select(@columns.collect { |column| [column.label, column.id] })) %>
    <%= hidden_field_tag :id, @dataset.id %>

    <%= submit_tag 'Choose', class: 'btn btn-default' %>
<% end %>

<div id='test_chart' style="height: 300px;margin: auto ;"></div>
